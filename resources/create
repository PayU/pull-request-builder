#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

aws --profile staging cloudformation create-stack \
      --stack-name $PROJECT_NAME \
      --parameters ParameterKey=GithubProjectName,ParameterValue=$GITHUB_PROJECT_NAME \
                   ParameterKey=GithubToken,ParameterValue=$GITHUB_TOKEN \
                   ParameterKey=ProjectName,ParameterValue=$PROJECT_NAME \
      --template-body file://$DIR/resources.yaml \
      --capabilities CAPABILITY_IAM \
      --capabilities CAPABILITY_NAMED_IAM && \

      aws --profile staging cloudformation wait stack-create-complete \
        --stack-name $PROJECT_NAME
